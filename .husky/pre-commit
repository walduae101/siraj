#!/usr/bin/env sh

echo "ğŸ” Running security and code quality checks..."

# Skip gitleaks if not available (rely on GitHub Actions for security scanning)
if command -v gitleaks &> /dev/null; then
  echo "ğŸ” Scanning for secrets..."
  gitleaks detect --verbose --redact --config=.gitleaks.toml
  if [ $? -ne 0 ]; then
    echo "âŒ SECURITY: Secrets detected! Commit blocked."
    echo "   Review the files above and remove any sensitive information."
    exit 1
  fi
  echo "âœ… Security scan passed"
else
  echo "âš ï¸  Gitleaks not found locally - relying on GitHub Actions for secret scanning"
fi

# Run existing checks
echo "ğŸ§¹ Running code quality checks..."
pnpm run check